dist: trusty
language: node_js
node_js:
- '11'
branches:
  only:
  - master
  - "/^v.*$/"
addons:
  apt:
    packages:
      - xvfb
install:
    - npm install -g xvfb-maybe
before_script:
    - export CHROME_BIN=chromium-browser
    - export DISPLAY=:99.0
    - sh -e /etc/init.d/xvfb start
    - npm install --quiet -g gulp
    - npm install
script:
    - npm run build
    - xvfb-maybe ./node_modules/karma/bin/karma start karma.conf.js --single-run
before_deploy:
    - npm run prerelease
deploy:
  - provider: releases
    skip_cleanup: true
    email: alexander_veit@hms.harvard.edu
    api_key:
      secure: GDBaub2nNx1nYMb3FurSrgF8k+2+FXC7XoNtO4/kzzBOyZ1hf8xQbOb0p82+lQs3gTmd2dTEQixfjOQ+ONhXlvC9mgRKELk7TE+BPDMgGpvAB06xEdH+WPeTxUEZf+aN/HEOB7ARq2qYRVdANrIQrnC1tkbG6y9osG5ZYqz9sALoE6k3mNR+9xEtD2eWDkDffFFBJ7ggSJn3Z6xN1uwcMPw7RuMhcIhJZVvmuw63BQGZGu6o0cz5ilYFgAYp+cskxT07v5I4jG7kkbKSV9Wf/o0VTkfG69QuVzq3LHzjNUQ3l9YJ9zG/eyaSJtM2GM7vFYdLTU2g8s17tqVT0awryaO9CxGBqsSTt0D6suqVp96DTowIlNd5vzglGZ8VG56p/TYgy41xTbFkkvBsP652666X4ESrYkLUAjJeZXESRZAwMcU/2uUNO/92250vf7V0oup/xsyVZqTbv2g5YFv0HMWl9UeNllmCfLRISs3EGg+1ZcBtOi/4HrjJn2kPSqImbsFYfODVH1klntePm0svv8sRO2HHNliEhaawTlgCZMgiMhvh0MhWAgJkRvaPEe3vWRum0+1cPpH5ESlbiQjzHKE6B/w98ZvD2DBWheiXSbv6E8CapnrooD//uGSy7QNWs6rbhf2QL/mqpt2Sp5dqmPAU2rR4wMB/fWnh8TuHTMY=
    file: dist.zip
    on:
      tags: true
      branch: master
      repo: higlass/higlass-transcripts
  - provider: npm
    skip_cleanup: true
    email: alexander_veit@hms.harvard.edu
    api_key:
      secure: LGNPZa1Xh1wHOI7yt5i7QDHFkXQky+CpEUoNfkB+9XbuSBlhda3WVuL965e4wlD+CtEqArZZBjPx/V5JjO5tbVEJ1uvCPuTAvQOkJha9Ht4bleuzXcr+7dM8FvIfVu5Jmm4W5K/qXUivcDjI1yXRwfNz1HnPuLxmYrc5V5k4feWcYgUD4khKhoNRbUxwUar0PpoHbdmd//dnccNKxYkS1PLHN+yDqBJ/1vNvm+GTq4zZcZiGzwrFSQD3yyLHlx+Rp4Yu/lxIqMm0WJwiezsyF+zwLcQjX7IDFejMGB9mJh0l478MwCcT9NN14RxIDOVetn/7fsWIFKynklweD2hBl/ZC8eH0D6j7Md/2G1OarM9ZW4rfDEmHGm/TMd2xWdy+DpMjG6o1fSrSirn07Rsf2a/DYBZkAualP7bygAFIOrVh5lE+gvSDu+JSpzENo+++BYZhchW0gZERX1o8LIaKvoUnClNIomND+dddN25b13qbJ598NDFcNQT2JjXOyiVgIkteEtR1qhgn/Rj1VyMKF2LKPdqdBixkX3IuQwipa8hUfL9O0yVuut5CvA22Zf25Zg9lx1nOHwDgHTbvRMGTMMtXZkvD9ETKSkHt7TP89ySvnmL0UtTLd96ROCRGKuF7apnd7igjnkb0do/ZwVIrkLLJk95a2Q6ujlexVRmePys=
    on:
      tags: true
      branch: master
      repo: higlass/higlass-transcripts
